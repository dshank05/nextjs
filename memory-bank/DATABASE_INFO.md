# Database Information Memory Bank

## üóÑÔ∏è Database Overview

### Production Database (Hostinger)
- **Database Name**: `your_database_name`
- **Username**: `your_username`
- **Password**: `your_password`
- **Remote Host**: `your-host.hstgr.io` (Primary) or `xxx.xxx.xxx.xxx` (Alternative)
- **Port**: `3306`
- **Type**: MySQL 5.7+

### Connection Status
- ‚úÖ **Remote Access**: Enabled for any host
- ‚úÖ **IP Restrictions**: None (can connect from anywhere)
- ‚úÖ **SSL**: Optional (can disable with `?sslmode=DISABLED`)
- ‚úÖ **Ready to Use**: No additional setup required

## üîó Connection Configuration

### Environment Variables
```env
# Production Database (Hostinger) - Ready to Use
DATABASE_URL="mysql://your_username:your_password@your-host.hstgr.io:3306/your_database_name"

# Alternative hostname if needed
# DATABASE_URL="mysql://your_username:your_password@xxx.xxx.xxx.xxx:3306/your_database_name"
```

### Prisma Configuration
```typescript
// Generated by Prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}
```

## üìä Database Structure

### Scale and Scope
- **Total Tables**: 29 tables
- **Total Products**: 4,111+ products in inventory
- **Business Data**: Live production data from existing Yii2 system
- **Years of Data**: Historical invoices, purchases, customer records

### Core Tables

#### Products and Inventory
- **`product`** - Main product catalog (4,111+ records)
- **`product_category`** - Product categories with names
- **`product_company`** - Company/brand information
- **`product_subcategory`** - Subcategory classifications

#### Sales and Invoices
- **`invoice`** - Invoice headers with totals and GST
- **`invoice_items`** - Invoice line items with quantities and rates
- **`customer`** - Customer information with billing/shipping addresses

#### Purchases and Vendors
- **`purchase`** - Purchase order headers
- **`purchase_items`** - Purchase line items (critical for rate calculations)
- **`vendor`** - Vendor/supplier information

#### Financial and Tax
- **GST Tables** - Tax rate configurations
- **Financial Year Tables** - FY tracking for invoices and purchases

## üéØ Critical Data Relationships

### Rate Calculation Dependencies
```sql
-- Critical for Latest Purchase Rate logic
SELECT pi.rate, pi.invoice_date 
FROM purchase_items pi 
WHERE pi.name_of_product = [product_id] 
ORDER BY pi.invoice_date DESC 
LIMIT 1
```

### Product Display Dependencies
```sql
-- Category name lookup
SELECT pc.category_name 
FROM product_category pc 
WHERE pc.id = [product.product_category]

-- Company name lookup  
SELECT co.company_name 
FROM product_company co 
WHERE co.id = [product.company]
```

### Stock Management Dependencies
```sql
-- Low stock detection
SELECT * FROM product 
WHERE stock = 0 OR stock < 2 OR stock < min_stock
```

## üõ†Ô∏è Database Tools and Access

### Prisma Studio - Visual Database Browser
```bash
cd nextjs
npm run prisma:studio
```

**Features Available:**
- ‚úÖ **Browse all 29 tables** in your database
- ‚úÖ **View, edit, add, delete records** with GUI
- ‚úÖ **Filter and search data** across tables
- ‚úÖ **See relationships** between products, invoices, customers
- ‚úÖ **Export data** to CSV format
- ‚úÖ **Debug data issues** with visual interface

**Access URL:** `http://localhost:5555`

### Command Line Tools
```bash
# Generate Prisma client
npm run prisma:generate

# Push schema to database (sync structure)
npm run prisma:db:push

# Reset database schema (careful!)
npm run prisma:db:push --force-reset

# View database schema
npx prisma db pull
```

## üîÑ Development vs Production

### Hybrid Development Approach
1. **Primary**: Connect to remote Hostinger database
2. **Alternative**: Local MySQL database for heavy development

### Environment Management
- **`.env.local`** - Local development settings
- **`.env.production`** - Production database settings
- **Switch easily**: Copy appropriate env file to `.env`

### Local Database Setup (Optional)
```sql
-- Create local database
CREATE DATABASE baijnath_inventory;
CREATE USER 'baijnath_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON baijnath_inventory.* TO 'baijnath_user'@'localhost';
FLUSH PRIVILEGES;
```

## ‚ö° Performance Characteristics

### Current Database Performance
- **Response Time**: Fast queries due to proper indexing in legacy system
- **Concurrent Users**: Handles multiple simultaneous connections
- **Data Volume**: Efficiently manages 4,111+ products with historical data
- **Transaction Support**: Full ACID compliance for financial data

### Optimization Opportunities
- **Indexes**: Review existing indexes for NextJS query patterns
- **Caching**: Implement caching for frequently accessed data
- **Connection Pooling**: Optimize Prisma connection management

## üö® Critical Connection Issues and Solutions

### Common Connection Problems
1. **Connection Timeout**: Usually resolves automatically, Hostinger has stable uptime
2. **SSL Issues**: Add `?sslmode=DISABLED` to connection string if needed
3. **Host Resolution**: Use IP address `193.203.184.29` if hostname fails

### Troubleshooting Commands
```bash
# Test database connection
npm run prisma:db:push

# Debug connection issues
npx prisma db pull

# Check schema sync
npx prisma generate
```

## üîí Security and Best Practices

### Security Measures
- **Environment Variables**: Never commit `.env` files to git
- **Connection Security**: Use strong passwords and rotate regularly
- **Access Control**: Monitor database access logs
- **Backup Strategy**: Regular backups of production data

### Development Security
- **Separate Environments**: Different credentials for dev/staging/production
- **IP Whitelisting**: Consider restricting access in production
- **SSL Encryption**: Enable SSL for production connections

## üìà Database Monitoring

### Health Check Queries
```sql
-- Check database size
SELECT 
  table_schema AS 'Database',
  SUM(data_length + index_length) / 1024 / 1024 AS 'Size (MB)'
FROM information_schema.tables
WHERE table_schema = 'your_database_name';

-- Check table record counts
SELECT table_name, table_rows
FROM information_schema.tables
WHERE table_schema = 'your_database_name'
ORDER BY table_rows DESC;
```

### Performance Monitoring
- **Query Performance**: Monitor slow queries and optimize
- **Connection Pool**: Track connection usage patterns
- **Data Growth**: Monitor table size growth over time

## üöÄ Migration and Deployment

### Zero Downtime Migration
- **Advantage**: NextJS connects to same database as legacy system
- **No Data Migration**: Uses existing production data immediately
- **Parallel Operation**: Can run alongside legacy system during transition

### Deployment Considerations
- **Environment Variables**: Securely configure production connection strings
- **Connection Limits**: Monitor concurrent connection usage
- **Backup Before Deploy**: Always backup before major releases

## üéâ Success Verification

### Connection Success Indicators
- ‚úÖ **Prisma Generate**: No errors during client generation
- ‚úÖ **Schema Sync**: Successful `prisma:db:push` execution
- ‚úÖ **Data Access**: Dashboard shows real statistics from production
- ‚úÖ **Studio Access**: Prisma Studio displays all tables and data
- ‚úÖ **API Responses**: Product APIs return actual inventory data

### Data Validation
- ‚úÖ **Product Count**: Should show 4,111+ products
- ‚úÖ **Categories**: Category names display correctly (not just IDs)
- ‚úÖ **Companies**: Company names resolve properly
- ‚úÖ **Latest Rates**: Purchase rates calculate correctly
- ‚úÖ **Stock Levels**: Stock status indicators work properly
